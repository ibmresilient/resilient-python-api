{# This report is generated by running:
  "resilient-sdk validate -p <path_to_package>"
  or
  "resilient-sdk validate -p <path_to_package> --<any_subcommand>"

  The report is generated each time the validate command is run and it will be
  output to a file named <path_to_package>/dist/validate_report.md
#}


{# BASIC INFO #}
# Validation Report for {{ display_name|defaults }}

| SDK Version       | Generation Time          | Command Line Arguments Provided |
| :---------------- | ------------------------ | ------------------------------- |
| {{ sdk_version }} | {{ timestamp|datetime }} | {{ args }} |

## Results
| **Severity** | **Count** |
| :----------- | --------- |
| Critical Issues:    | <span style="color:red"> {{ criticals }} </span> |
| Warnings:           | <span style="color:orange"> {{ warnings }} </span>  |
| Validations Passed: | <span style="color:green"> {{ passes }}  </span>   |


{% if "details" in validate_issues_dict %}
## App Details
{# APP DETAILS #}
| Attribute | Value |
| --------- | ----- |
{% for attr, val in validate_issues_dict["details"] %}
{% if val|is_dict %}
| `{{ attr }}` | {{ val|pprint|replace("\n", "<br>")|defaults }} |
{% else %}
| `{{ attr }}` | {{ val|replace("\n", "")|defaults }} |
{% endif %}
{% endfor %}
{% endif %}

---


{# SETUP.PY values if ran #}
{% if "setup.py" in validate_issues_dict %}
## `setup.py` file validation
| Severity | Name | Description | Solution |
| --- | --- | --- | --- |
{% for issue in validate_issues_dict["setup.py"] %}
{% if issue.severity <= SEVERITY_THRESHOLD %}
| {{ issue.severity_to_color() }} | {{ issue.name|scrub_ansi|code|dot_py }} | {{ issue.description|scrub_ansi|code|dot_py }} | {{ issue.solution|scrub_ansi|code|dot_py }} |
{% endif %}
{% endfor %}

{# check if the validation passes #}
{% if validate_issues_dict["setup.py"][0].severity > SEVERITY_THRESHOLD %}
<span style="color:green">Success</span>

{% endif %}

---
{% endif %}


{# PACKAGE FILES values if ran #}
{% if "package files" in validate_issues_dict %}
## Package files validation
{% for issue in validate_issues_dict["package files"] %}

### {{ issue.name|scrub_ansi|code|dot_py }}
{% if issue.severity <= SEVERITY_THRESHOLD %}
{{ issue.severity_to_color() }}: {{ issue.description|scrub_ansi|diff|code }}

{{ issue.solution|scrub_ansi|code }}

{% else %}
<span style="color:green">Pass</span>

{% endif %}
{% endfor %} {# endfor all package files issues#}

---
{% endif %} {# endif package files exists #}


{# Payload Samples values if ran #}
{% if "payload samples" in validate_issues_dict %}
## Payload samples validation
{% for issue in validate_issues_dict["payload samples"] %}

### {{ issue.name|scrub_ansi|code|dot_py }}
{% if issue.severity <= SEVERITY_THRESHOLD %}
{{ issue.severity_to_color() }}: {{ issue.description|scrub_ansi|diff|code }}

{{ issue.solution|scrub_ansi|code }}

{% else %}
<span style="color:green">Pass</span>

{% endif %}
{% endfor %} {# endfor all paylaod samples issues#}

---
{% endif %} {# endif payload samples exists #}


{# SELFTEST if ran #}
{% if "selftest.py" in validate_issues_dict %}
## `resilient-circuits` selftest
{% for issue in validate_issues_dict["selftest.py"] %}
{% if issue.severity <= SEVERITY_THRESHOLD %}
{{ issue.severity_to_color() }}: {{ issue.description|scrub_ansi|code }}

{{ issue.solution|scrub_ansi|code }}
{% endif %}
{% endfor %}

{% if validate_issues_dict["selftest.py"][0].severity > SEVERITY_THRESHOLD %}
<span style="color:green">Success</span>

{% endif %}

---
{% endif %} {# endif selftest #}


{# tests if ran #}
{% if "tests" in validate_issues_dict %}
## tox tests
{% for issue in validate_issues_dict["tests"] %}
{% if issue.severity <= SEVERITY_THRESHOLD %}
{{ issue.severity_to_color() }}: {{ issue.description|scrub_ansi|code }}

{{ issue.solution|scrub_ansi|code }}

{% endif %}
{% endfor %}

{% if validate_issues_dict["tests"][0].severity > SEVERITY_THRESHOLD %}
<span style="color:green">Success</span>

{% endif %}

---
{% endif %} {# endif tox tests #}


{# pylint if ran #}
{% if "pylint" in validate_issues_dict %}
## Pylint Scan
{% for issue in validate_issues_dict["pylint"] %}
{% if issue.severity <= SEVERITY_THRESHOLD %}
{{ issue.severity_to_color() }}: {{ issue.description|scrub_ansi|code }}

{{ issue.solution|scrub_ansi|code }}

{% endif %}
{% endfor %}

{% if validate_issues_dict["pylint"][0].severity > SEVERITY_THRESHOLD %}
<span style="color:green">Success</span>

{% endif %}

---
{% endif %} {# endif pylint scan #}


{# bandit if ran #}
{% if "bandit" in validate_issues_dict %}
## Bandit Scan
{% for issue in validate_issues_dict["bandit"] %}
{% if issue.severity <= SEVERITY_THRESHOLD %}
{{ issue.severity_to_color() }}: {{ issue.description|scrub_ansi|code }}

{{ issue.solution|scrub_ansi|code }}

{% endif %}
{% endfor %}

{% if validate_issues_dict["bandit"][0].severity > SEVERITY_THRESHOLD %}
<span style="color:green">Success</span>

{% endif %}

---
{% endif %} {# endif bandit scan #}
